hmLoadTopic({
hmKeywords:"",
hmTitle:"BLE Communication",
hmDescription:"In HsM BLE-networked devices are communicate with HsM gateway devices ",
hmPrevLink:"resource-instance-ids.html",
hmNextLink:"comm-ble-advertisement.html",
hmParentLink:"comm.html",
hmBreadCrumbs:"<a href=\"comm.html\">Common<\/a>",
hmTitlePath:"Common > BLE Communication",
hmHeader:"<h1 class=\"p_Heading1\"><span class=\"f_Heading1\">BLE Communication<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">In HsM BLE-networked devices are communicate with HsM gateway devices <\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The gateways connect non-gateway devices to the HsM HsM Backend.<\/p>\n\r<p class=\"p_Normal\">Non-gateway devices act as BLE peripherals. The send out advertising packets to notify other BLE devices (including the HsM gateway devices) of their existence and to provide some basic information bout their current status.. The HsM non-gateway devices will allow connections from other BLE devices (BLE centrals). In HsM HsM mobile gateways and stationary gateways act as BLE centrals. They discover non-gateway devices in their vicinity by listening and processing advertising packets and they build up connections to the non-gateway devices in order to read and write data.<\/p>\n\r<p class=\"p_Normal\">The non-gateway &nbsp;devices (BLE peripherals) and gateway devices (BLE Central) can therefore be in a <span class=\"f_Term\">connected<\/span> mode or in an <span class=\"f_Term\">advertising-discvovery<\/span> mode. The difference is that in the connected mode allows bi-directional data transfer between the connected data device, in the advertising-discovery mode the peripheral does not know about the central and therefor can only broadcast information, the Central only processes advertising packets and does not interact with the device.<\/p>\n\r<p class=\"p_Normal\">Generally HsM non-gateway devices allow maximum 2 BLE connections from &nbsp;to gateway devices at the same time.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">A connection to a device is necessary to interact with it in a bluetooth context. For end user interaction more steps are necessary:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Service discovery<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>characteristic discovery<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>notify enable<\/p><p class=\"p_Normal\">Only If those steps are successfully completed sensor values can be read \/ written. These steps are mandatory. Therefore, the xibu app will always execute all those steps when connecting to a dispenser is necessary, followed by the action that has to be executed. (e.g. reading out sensor values, enumerating all sensors or changing settings)<\/p>\n\r<p class=\"p_Normal\">On Android the service &amp; characteristics discoveries are handled by the Bluetooth library \/ the Android system. The notification characteristic is subscribed to for as long as the connection is kept open by the app.<\/p>\n\r<p class=\"p_Normal\"><a id=\"browsing\" class=\"hmanchor\"><\/a><\/p>\n\r<p class=\"p_Normal\">Whenever a device is synced a timestamp is saved for this device. The browsing algorithm will respect this timestamp and only sync a device when the time stamp is older than 15 minutes. Nevertheless, this only handles the connection establishing and syncing of one device, the advertisement collection is not effected by this.<\/p>\n\r<p class=\"p_Normal\">The app user can chose whether mobile data should be used to sync data gathered through ‘Browsing’ or not. When the mobile data usage is disabled, the requests will be queued in the offline queue and executed later.<\/p>\n\r<p class=\"p_Normal\"><a id=\"browsing-triggers\" class=\"hmanchor\"><\/a><\/p>\n\r<p class=\"p_Normal\">The browsing algorithm is triggered by:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>App in foreground at organisation\/customer\/device list<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>App in background through beacons<\/p><p class=\"p_Normal\">The dispenser creates beacons, which wakes up the apps. An app is only waked when entering or leaving a beacon. Therefore, the dispensers iterate through 16 beacon ids to simulate leaving and entering regions.<\/p>\n\r<p class=\"p_Normal\">1&quot;4cf5c9d2-21c1-4991-bd40-5aac5b2156ff&quot; 2&quot;b1e3877a-3624-422d-b19c-ae1d04b19ab0&quot; 3&quot;bc68d385-ae22-4134-acc3-d8fdd1765571&quot; 4&quot;30d8018a-0c1b-4846-a751-df60d9bc9539&quot; 5&quot;032cb2a0-8273-41c0-b4c4-bdc8a87278d5&quot; 6&quot;03838efc-0cbd-4cba-83e7-1464ba3d7062&quot; 7&quot;c65a5e9b-ae70-40ef-b698-e70b616e3f91&quot; 8&quot;bfe8c673-c2bb-48df-a0c2-06664dd5e37e&quot; 9&quot;c7978071-d892-475d-adac-f0269e4377ed&quot; 10&quot;6761360b-9865-4168-b638-70f076fa65b3&quot; 11&quot;3b2282e0-2dbc-4cdc-a009-aa66cce89e46&quot; 12&quot;78afc740-b026-4c7c-a8fb-ed091d1d7521&quot; 13&quot;0b111619-78b1-48b0-8913-e737aba80501&quot; 14&quot;d0aa9ef7-c69c-48c4-b6d4-981de6c820d5&quot; 15&quot;cb348a0f-c0e2-44a9-9a1b-427f61f3fbda&quot; 16&quot;dcee6eb2-2a4a-4586-b408-e8a833804f84&quot;<\/p>\n\r<p class=\"p_Normal\">When an app is woken up it will start to browse dispensers in the background mode.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Bluetooth Verbindung blinkt die blaue LED ca. alle 4.7 Sekunden - solang man verbunden ist<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Locate device action (schreiben wir automatisch auf den Spender) blinkt die blaue LED ca. alle 0.5 Sekunden - das hört auch automatisch auf wenn die Bluetooth Verbindung getrennt wird<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>&quot;LED blinken&quot; Einstellung lässt die grüne LED ca. alle 4.3 Sekunden blinken<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Wenn LED blinken deaktiviert ist und der Spender voll ist, blinkt er gar nicht<\/p><p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Wenn der Spender leer ist blinkt der Spender grün-rot<\/p>"
})
